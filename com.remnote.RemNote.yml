app-id: com.remnote.RemNote
base: org.electronjs.Electron2.BaseApp
base-version: '25.08'
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: start-remnote
rename-icon: remnote
rename-desktop-file: remnote.desktop
separate-locales: false
tags:
  - proprietary
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --device=dri
  - --share=network
  - --share=ipc
  # Needed to save files locally
  - --filesystem=~/remnote:create
  - --filesystem=xdg-documents
  # Ensure proper mouse cursor scaling on HiDPI displays under Wayland
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons
  # Use gio for trash operations
  - --env=ELECTRON_TRASH=gio
modules:
  - name: remnote
    buildsystem: simple
    build-commands:
      # Extract AppImage
      - chmod +x RemNote.AppImage
      - ./RemNote.AppImage --appimage-extract
      # Patch .desktop file
      - desktop-file-edit --set-key=Exec --set-value='start-remnote %U' squashfs-root/remnote.desktop
      - desktop-file-edit --set-comment='The all-in-one tool for thinking and learning.'
        squashfs-root/remnote.desktop
      # Copy over the required files
      - install -Dm755 -t "${FLATPAK_DEST}/bin" start-remnote
      - install -Dm644 -t "${FLATPAK_DEST}/share/metainfo" "${FLATPAK_ID}.metainfo.xml"
      - install -Dm644 -t "${FLATPAK_DEST}/share/applications" squashfs-root/remnote.desktop
      - install -Dm644 -t "${FLATPAK_DEST}/share/icons/hicolor/512x512/apps" squashfs-root/usr/share/icons/hicolor/0x0/apps/remnote.png
      - mv squashfs-root "${FLATPAK_DEST}/remnote"
    sources:
      - type: file
        path: com.remnote.RemNote.metainfo.xml
      # Wrapper to launch the app
      - type: script
        dest-filename: start-remnote
        commands:
          - export TMPDIR="${XDG_RUNTIME_DIR}/app/${FLATPAK_ID}"
          # '--disable-features=GlobalShortcutsPortal' is needed due to https://issues.chromium.org/issues/404298968
          # Remove this flag when upstream updates to a Chromium version where this issue no longer exists.
          - zypak-wrapper /app/remnote/remnote --ozone-platform-hint=auto --disable-features=GlobalShortcutsPortal
            "$@"
      - type: file
        dest-filename: RemNote.AppImage
        url: https://download2.remnote.io/remnote-desktop2/RemNote-1.21.8.AppImage
        sha256: 2891dd2c798b198631bf878a083a14b139f76e15a0de1f103a5c26b713450ba6
        x-checker-data:
          type: rotating-url
          url: https://backend.remnote.com/desktop/linux
          pattern: https://download2.remnote.io/remnote-desktop2/RemNote-([0-9.]+).AppImage
