app-id: com.remnote.RemNote
base: org.electronjs.Electron2.BaseApp
base-version: "25.08"
runtime: org.freedesktop.Platform
runtime-version: "25.08"
sdk: org.freedesktop.Sdk
command: start-remnote
separate-locales: false
tags:
  - proprietary
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --device=dri
  - --share=network
  - --share=ipc
  # Needed to save files locally
  - --filesystem=home
  # Ensure proper mouse cursor scaling on HiDPI displays under Wayland
  - --env=XCURSOR_PATH=/run/host/user-share/icons:/run/host/share/icons
  # Use gio for trash operations
  - --env=ELECTRON_TRASH=gio
modules:
  - name: remnote
    buildsystem: simple
    build-commands:
      - chmod +x RemNote.AppImage
      - ./RemNote.AppImage --appimage-extract
      - rm RemNote.AppImage
      - mv squashfs-root "${FLATPAK_DEST}/remnote"
      - install -Dm755 start-remnote.sh             -T "${FLATPAK_DEST}/bin/start-remnote"
      - install -Dm644 "${FLATPAK_ID}.desktop"      -t "${FLATPAK_DEST}/share/applications"
      - install -Dm644 "${FLATPAK_ID}.png"          -t "${FLATPAK_DEST}/share/icons/hicolor/512x512/apps"
      - install -Dm644 "${FLATPAK_ID}.metainfo.xml" -t "${FLATPAK_DEST}/share/metainfo"
    sources:
      - type: file
        path: com.remnote.RemNote.desktop
      - type: file
        path: com.remnote.RemNote.png
      - type: file
        path: com.remnote.RemNote.metainfo.xml
      # Wrapper to launch the app
      - type: script
        dest-filename: start-remnote.sh
        commands:
          - export TMPDIR="${XDG_RUNTIME_DIR}/app/${FLATPAK_ID}"
          - zypak-wrapper /app/remnote/remnote --no-sandbox --ozone-platform-hint=auto "$@"
      - type: file
        dest-filename: RemNote.AppImage
        url: https://download2.remnote.io/remnote-desktop2/RemNote-1.21.5.AppImage
        sha256: 4eaf2aca397207fd6d424079acb5522f2f076e99df059e1098d401fc254488dd
        x-checker-data:
          type: rotating-url
          url: https://backend.remnote.com/desktop/linux
